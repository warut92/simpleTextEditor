<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simple Text Editor</title>
  <link rel="icon" type="image/x-icon" href="icon.png">
  <link rel="manifest" href="manifest.json" />
  <style>
    body, * {
      font-family: consolas;
    }
    #editor {
      display: flex;
    }
    #lineNumbers {
      width: 10px;
      text-align: right;
      padding-right: 9px;
      padding-top: 5px;
      border-right: 2px solid #ccc;
      user-select: none;
    }
    #textarea {
      flex-grow: 1;
      width: calc(100% - 45px); /* Adjust according to the width of line numbers */
      height: 300px;
      border: none;
      padding: 5px;
    }
    #textarea:focus {
    outline: none !important;
 }
 #wordCount {
  font-size: 10px;
 }

 body {
  color: #222;
  background: #fff;
  font: 100% system-ui;
}
a {
  color: #0033cc;
}

@media (prefers-color-scheme: dark) {
  body, textarea {
    color: #eee;
    background: #121212;
  }

  body a {
    color: #809fff;
  }
}
  </style>
</head>
<body>
  <div id="editor">
    <div id="lineNumbers"></div>
    <textarea id="textarea"></textarea>
  </div>
  <br>
  <small><div id="wordCount">Word Count: <span id="wordCountValue">0</span></div>

  <script>
    window.onload = function() {
      var textarea = document.getElementById('textarea');
      var lineNumbers = document.getElementById('lineNumbers');
      var wordCountSpan = document.getElementById('wordCountValue');

      textarea.addEventListener('input', function() {
        syncLineNumbers();
        saveToLocalStorage(textarea.value);
        countWords()
      });

      textarea.addEventListener('keydown', function(event) {
        if (event.ctrlKey && event.key === 's') {
          event.preventDefault(); // Prevent default browser save action
          saveAsPlainTextFile(textarea.value);
        }
      });

      function countWords() {
        var text = textarea.value.trim();
        var words = text.split(/\s+/).filter(function(word) {
          return word.length > 0;
        });
        wordCountSpan.textContent = words.length;
      }

      // Load text from local storage on page load
      var savedText = localStorage.getItem('editorText');
      if (savedText) {
        textarea.value = savedText;
      }
      syncLineNumbers(); // Sync line numbers on page load
      countWords()

      function syncLineNumbers() {
        var lines = textarea.value.split('\n').length;
        var linesArr = textarea.value.split('\n');
        for (let i = 0; i < linesArr.length; i++) {
          linesArr[i].length
          console.log('LINES[I].LENGTH', linesArr[i].length)
        }
        var lineNumbersContent = '';
        for (var i = 1; i <= lines; i++) {
          lineNumbersContent += i + '<br>';
        }
        lineNumbers.innerHTML = lineNumbersContent;
      }

      function countWords() {
       var text = textarea.value.trim();
       var words = text.split(/\s+/).filter(function(word) {
         return word.length > 0;
       });
       wordCountSpan.textContent = words.length;
     }

      function saveToLocalStorage(text) {
        localStorage.setItem('editorText', text);
      }

      function saveAsPlainTextFile(text) {
        var blob = new Blob([text], { type: 'text/plain' });
        var a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'text_file.txt';
        a.style.display = 'none';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      }
    };
  </script>
</body>
</html>
